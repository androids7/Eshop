<!DOCTYPE html>
<!-- saved from url=(0070)http://www.zol.com/index.php?c=Detail&a=FlowNumberIframe&isShopIndex=1 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=GBK">
<meta charset="gbk">
<title>mobileiframe</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link rel="stylesheet" href="">
<style>
	body,dl,dt,dd,ul,li{margin: 0; padding: 0;}
	ul,ol{list-style:none outside none;}
	body{color: #333; font: 12px/1.5 "Microsoft Yahei","\5FAE\8F6F\96C5\9ED1";}
	a{text-decoration: none;}
	
	/**/
	.feature-services .select .title,.feature-services .link em
	{background: url(http://icon.zol-img.com.cn/mobile/150608/mobile2015-icon1.png) no-repeat;}
	
	.feature-services{height: 209px; width: 438px;}
	.feature-services dl{float: left; padding: 0 0 0 20px;}
    .feature-services .flow-service{width: 186px;}
	.feature-services dl dt{margin: 5px 0 0; font-size: 14px; line-height: 32px;}
	
	.feature-services .flow-item{position: relative; margin: -3px 0 0;}
	.feature-services li{height: 30px; margin: 10px 0 0; line-height: 30px; vertical-align: middle;}
	.feature-services li label{float: left; padding: 0 12px 0 0; font-size: 12px;}
	.feature-services li input{position: relative; zoom: 1; display: block; width: 115px; height: 28px; overflow: hidden; padding: 0 8px; border: 1px #e6e6e6 solid; background: #fff; color: #333; font: normal 12px/28px "Microsoft Yahei","\5FAE\8F6F\96C5\9ED1";}
	.feature-services .select{position: relative; zoom: 1; float: left; width: 133px; color: #666; cursor: pointer;}
	.feature-services .select .title{position: relative; zoom: 1; display: block; padding: 0 21px 0 8px; width: 102px; height: 28px; overflow: hidden; border: 1px #e6e6e6 solid; background-position: 100% -20px; background-color: #fff; line-height: 28px;}
	.feature-services .select .list{position: absolute; top: 29px; left: 0; width: 131px; height: 78px; overflow: auto; display: none; border: 1px #ccc solid; border-top: 0 none; background-color: #fff;}
	.feature-services .select .list span{display: block; padding: 0 8px; line-height: 26px;}
	.feature-services .select .list span:hover{background-color: #fafafa;} 
	.feature-services .select:hover .title{border-color: #ccc;}
	.feature-services .select-hover .title{border-color: #ccc; background-position: 100% -50px;}
	.feature-services .select-hover .list{display: block;}
	.feature-services .price{color: #f33; font: normal 12px/30px "Microsoft Yahei","\5FAE\8F6F\96C5\9ED1";}
	
	.feature-services .button-box{height: 30px; margin: 8px 0 0;}
	.feature-services .button-box a{float: left; width: 88px; height: 30px; -webkit-border-radius: 2px; border-radius: 2px; background: #2E97F0; color: #fff; font-size: 14px; text-align: center; line-height: 30px; text-decoration: none;}
	.feature-services .button-box .rechange-btn{margin: 0 10px 0 0;}
	.feature-services .button-box .discount-btn{background: #FF4747;}
	
	.feature-services .link{width: 206px; overflow: hidden; zoom: 1;}
	.feature-services .link a{position: relative; zoom: 1; float: left; margin: 7px 8px 1px 0; padding: 34px 0 0; width: 90px; height: 34px; border: 1px #e6e6e6 solid; text-align: center; color: #666; font-size: 14px; line-height: 34px; background-color: #fff;}
	.feature-services .link em{position: absolute; left: 50%;}
	.feature-services .link .ico-1{top: 10px; margin: 0 0 0 -16px; width: 27px; height: 24px; background-position: 0 -420px;}
	.feature-services .link .ico-2{top: 14px; margin: 0 0 0 -13px; width: 26px; height: 19px; background-position: -30px -420px;}
	.feature-services .link .ico-3{top: 12px; margin: 0 0 0 -14px; width: 25px; height: 21px; background-position: 0 -445px;}
	.feature-services .link .ico-4{top: 13px; margin: 0 0 0 -11px; width: 22px; height: 21px; background-position: -30px -440px;}
	.feature-services .link a:hover{color: #2e99f3; text-decoration: none; border-color: #2e99f3;}
	.feature-services .link a:hover .ico-1{background-position: 0 -470px;}
	.feature-services .link a:hover .ico-2{background-position: -30px -465px;}
	.feature-services .link a:hover .ico-3{background-position: 0 -495px;}
	.feature-services .link a:hover .ico-4{background-position: -30px -485px;}
    

</style>
<script src="jquery-1.8.3.min.js"></script><style type="text/css"></style>
</head>
<body>
  <div class="feature-services">
  	<dl class="flow-service" style="padding:0px;">
        <dt style="display:none">手机流量充值</dt>
  		<dd>
  			<ul class="flow-item">
  				<li>
  					<label for="numberItem">号码</label>
  					<input type="text" id="numberItem" placeholder="请输入手机号码" maxlength="11" value="">
  				</li>
  				<li>
  					<label for="flowItem">流量</label>
  					<div class="select" id="flowItem">
						<span class="title" id="flowItem-title">
                                5M                            </span>
						<div class="list sel-layer" id="flowItem-layer">
                                                        							<span class="sel-item" data-price="1.43" data-product-id="P33">
                                5M                            </span>
                            							<span class="sel-item" data-price="2.38" data-product-id="P34">
                                10M                            </span>
                            							<span class="sel-item" data-price="3.80" data-product-id="P47">
                                20M                            </span>
                            							<span class="sel-item" data-price="5.70" data-product-id="P35">
                                30M                            </span>
                            							<span class="sel-item" data-price="7.60" data-product-id="P7">
                                50M                            </span>
                            							<span class="sel-item" data-price="13.30" data-product-id="P48">
                                100M                            </span>
                            							<span class="sel-item" data-price="17.10" data-product-id="P38">
                                200M                            </span>
                            							<span class="sel-item" data-price="38.00" data-product-id="P49">
                                500M                            </span>
                            							<span class="sel-item" data-price="114.00" data-product-id="P50">
                                1G                            </span>
                                                        						</div>
					</div>
  				</li>
  				<li>
  					<label for="flowPrice">价格</label>
                    <em class="price">￥<span id="show-price-span">1.43</span></em> <span style="color:#666;margin-left:10px;">9.5折</span>
  				</li>
  			</ul>
  			
  			<div class="button-box">
  				<a href="javascript:void(0);" class="rechange-btn" style="background:#f33;" id="charge-flow-now-a">立即充值</a>
                <!--<a href="http://hh.zol.com/index.php?c=Detail&a=GoodsChooseDetail&goodsId=25242003" target="_blank" class="discount-btn">更多优惠</a>-->
  			</div>
  		</dd>
  	</dl>
  	<dl class="feature-service" style="display:none">
  		<dt>特色服务</dt>
  		<dd>
  			<div class="link clearfix">
				<a href="http://2.zol.com.cn/" target="_blank"><em class="ico-1"></em>卖手机</a>
				<a href="http://detail.zol.com.cn/ProductComp_param_subcate57.html" target="_blank"><em class="ico-2"></em>对比</a>
				<a href="http://2.zol.com.cn/yihuanji.php" target="_blank"><em class="ico-3"></em>评估</a>
				<a href="http://2.zol.com.cn/mlist.php?bs=1" target="_blank"><em class="ico-4"></em>回收</a>
			</div>
  		</dd>
  	</dl>
  </div>
  

<script>
//常量
var constants = {
    mobileInfoUrl: '/index.php?c=Ajax_FlowNumber&a=GetMobileInfo',
    submitUrl: '/index.php?c=Ajax_FlowNumber&a=SubmitOrderInfo'
};

//全局变量
window.productInfo          = {"2":{"20":{"typeId":2,"productId":"P47","productName":"20M","price":"3.80"},"50":{"typeId":2,"productId":"P7","productName":"50M","price":"7.60"},"100":{"typeId":2,"productId":"P48","productName":"100M","price":"13.30"},"200":{"typeId":2,"productId":"P14","productName":"200M","price":"19.00"},"500":{"typeId":2,"productId":"P49","productName":"500M","price":"38.00"},"1000":{"typeId":2,"productId":"P50","productName":"1G","price":"114.00"}},"1":{"5":{"typeId":1,"productId":"P33","productName":"5M","price":"1.43"},"10":{"typeId":1,"productId":"P34","productName":"10M","price":"2.38"},"30":{"typeId":1,"productId":"P35","productName":"30M","price":"5.70"},"50":{"typeId":1,"productId":"P36","productName":"50M","price":"7.60"},"100":{"typeId":1,"productId":"P37","productName":"100M","price":"11.40"},"200":{"typeId":1,"productId":"P38","productName":"200M","price":"17.10"},"500":{"typeId":1,"productId":"P39","productName":"500M","price":"34.20"},"1000":{"typeId":1,"productId":"P40","productName":"1G","price":"57.00"}}}; //按运营商划分的流量产品
window.selectFlowInfo       = {}; //选择的流量产品信息
    
//插件
$(function($) {
    $.extend({
        //取得随机数
        getRandom: function(min, max) {
            if (max == null) {
                max = min;
                min = 0;
            }
            return min + Math.floor(Math.random() * (max - min + 1));
        },
        
        //检查号码格式
        checkMobile: function(mobile) {
            var checkReg = /^1[3,4,5,7,8]{1}[0-9]{9}$/;
            
            return checkReg.test(mobile);
        },
        
        //加载运营商的流量产品
        loadOperatorProduct: function(type) { //type  1:电信     2:联通     3:移动 
            var selectHtml          = '',
                operatorProductInfo = null,
                flowDiv             = $('#flowItem-layer');
            
            if(null == type) {
                type = 1;
            }
            operatorProductInfo = window.productInfo[type];
            
            //拼装下拉框html代码
            if(operatorProductInfo) {
                $.each(operatorProductInfo, function() {
                    selectHtml  += '<span class="sel-item" data-price="' + this.price + '" data-product-id="' + this.productId + '">' + this.productName + '</span>';
                });
            }
            
            //没有相关的流量产品
            if(!selectHtml) {
                selectHtml = '<span class="sel-item" data-price="0">暂无产品</span>';
            }
            
            flowDiv.empty();
            flowDiv.append(selectHtml);
            
            //默认选择第一项
            $.defaultSelect();
        },
        
        //显示号码所属运营商的流量产品
        showMobileOperatorProduct: function(mobile) {
            var url     = constants.mobileInfoUrl + '&t=' + $.getRandom(1, 9999),
                data    = {mobile: mobile};
        
            $.getJSON(url,data,function(backdata){
                if(backdata.flag){
                    $.loadOperatorProduct(backdata.type);
                } else {
                    window.selectFlowInfo = {};
                }
            });
        },
        
        //提交状态监听
        isAlreadySubmit: function() {
            return window.isAlreadySubmit;
        },
        lockSubmitBtn: function() {
            window.isAlreadySubmit = 1;
        },
        unlockSubmitBtn: function() {
            window.isAlreadySubmit = 0;
        },
        
        //默认选择
        defaultSelect: function() {
            var defaultItem     =  $('.sel-item:first'),
                price           =  defaultItem.data('price'),
                productId       =  defaultItem.data('productId'),
                flowItemTitle   = $('#flowItem-title'),
                showPriceSpan   = $('#show-price-span');
            
            if(0 == defaultItem.size()) {
                return;
            }
            
            //回显流量
            flowItemTitle.text(defaultItem.text());

            //显示价格
            showPriceSpan.text(price);

            //保存选中的信息
            window.selectFlowInfo.price     = price;
            window.selectFlowInfo.productId = productId;
        }
    });
});
    
$(function($) {
    $.defaultSelect();

    $(document)
    //点击页面其他部分隐藏下拉框
    .on('click', function() {
        var flowItemDiv     = $('#flowItem');
        
        flowItemDiv.removeClass('select-hover');
    })
    
    .on('click', '#flowItem', function(event) {
        var isSelect = $(this).is('.select-hover');
        
        event.stopPropagation();
        event.preventDefault();
        
        //下拉框切换
        if(isSelect) {
            $(this).removeClass('select-hover');
        } else {
            $(this).addClass('select-hover');
        }
    })
    .on('click', '.sel-item', function(event) {
        var price           = $(this).data('price'),
            flowItemDiv     = $('#flowItem'),
            showPriceSpan   = $('#show-price-span'),
            flowItemTitle   = $('#flowItem-title'),
            productId       = $(this).data('productId');
            
        event.stopPropagation();
        event.preventDefault();

        //关闭选择框
        flowItemDiv.removeClass('select-hover');
        
        //回显流量
        flowItemTitle.text($(this).text());
        
        //显示价格
        showPriceSpan.text(price);
        
        //保存选中的信息
        window.selectFlowInfo.price     = price;
        window.selectFlowInfo.productId = productId;
    })
    
    //判断号码格式
    .on('blur', '#numberItem', function() {
        var phoneNum = $(this).val();

        if($.checkMobile(phoneNum)) {
            window.selectFlowInfo.phoneNum  = phoneNum;
            $.showMobileOperatorProduct(phoneNum);
        } else {
            window.selectFlowInfo       = {};
        }
    })
    
    //充值
    .on('click', '#charge-flow-now-a', function() {
        var url     = constants.submitUrl + '&t=' + $.getRandom(1, 9999),
            data    = null;
        
        //验证手机号码和流量
        if(null == window.selectFlowInfo.phoneNum) {
            alert('请填写正确的手机号码');
            return;
        }
        if(null == window.selectFlowInfo.productId) {
            alert('请选择流量');
            return;
        }
        if($.isAlreadySubmit()) {
//            alert('生成订单中，请稍候...');
            return;
        }
        $.lockSubmitBtn();
        
        //提交流量订单
        data = {
            merchantId: 190970, 
            mobile: window.selectFlowInfo.phoneNum, 
            zyProductId: window.selectFlowInfo.productId, 
            shareId: 24
        };  
        $.ajax({
            url: url,
            data: data,
            type: 'get',
            dataType: 'json',
            success: function(backdata) {
                if(!backdata.flag) {
                    alert(backdata.msg);
                    $.unlockSubmitBtn();
                } else {
                    //订单提交成功，跳转支付页
                    top.location = backdata.url;
                }
            },
            error: function() {
                alert('非常抱歉！提交订单失败，请稍后再试');
            }
        });
    });
    
});
</script>

</body></html>